<!--
   Copyright (c) 2016 by Plexim GmbH
   All rights reserved.
-->

<!DOCTYPE html>
<html id="ng-app" ng-app="rtBox" lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link href="css/bootstrap.min.css" rel="stylesheet">
<link href="css/rtbox.css" rel="stylesheet">
<link href="css/c3.css" rel="stylesheet" type="text/css">
<script src="js/jquery.min.js"></script>
<script src="js/d3.min.js" charset="utf-8"></script>
<script src="js/c3.min.js"></script>
<script src="js/angular.min.js"></script>
<!-- <script src="js/c3-angular.min.js"></script> -->
<script src="js/c3-angular.js"></script>
<script src="js/ui-bootstrap-tpls-1.2.4.min.js"></script>
<script src="js/xmlrpc.min.js"></script>
<script src="js/rtbox.js"></script>
<!--<script src="js/rtboxchart.js"></script>-->
<title>PLECS RT Box 1</title>
</head>

<body ng-controller="modelCtrl" role="document">
<div class="well">
<div class="container">
   <h1>PLECS RT Box 1</h1>
   <p>{{hostname}}
      <span class="error-text">{{serverStatusMsg()}}</span>&nbsp;
   </p>
</div>
</div>

<div class="container" role="main">


<ng-form>
<div ng-controller="tabsCtrl" class="tabset">
   <uib-tabset active="activeTab">
      <uib-tab index="0" heading="Application">
         <div class="panel panel-default">
            <div class="panel-heading"><label>Model</label></div>
            <div class="panel-body">
					<table class="table table-condensed table-info">                                                      
						<tbody>
							<tr>
								<td>Model name:</td>
								<td>{{modelName}}</td>
							</tr>
							<tr>
								<td>Sample time:</td>
								<td><span ng-if="sampleTime">{{sampleTime/1000}} &mu;s</span></td>
							</tr>
						</tbody>
					</table>
				</div>
			</div>
         <div class="panel panel-default">
            <div class="panel-heading"><label>Simulation</label></div>
            <div class="panel-body">
					<div class="row">
						<div class="col-sm-12">
							Processor load:
						</div>
					</div>
					<div class="row">
						<div class="col-sm-4">
							<c3chart bindto-id="gauge-exec-time"
							     padding-top="40"
							     padding-bottom="20"
							     chart-data="execTime"
							     chart-columns="structExecTime"
							     transition-duration="0">
							  <chart-size chart-height="180" chart-width="200"/>
							  <chart-gauge min="0"
											max="100"
											units="%"
											label-format-function="formatExecTime"
											width="39"/>
							</c3chart>
						</div>
						<div class="col-sm-8">
							<c3chart bindto-id="chart-exec-time"
							     chart-data="execTimeHist"
							     chart-columns="structExecTimeHist"
							     transition-duration="0">
								<chart-size chart-height="200" chart-width="400"/>
								<chart-grid show-y="true"/>
								<chart-axis-x
									padding-left="0"
									padding-right="1">
									<chart-axis-x-tick
										tick-culling-max="1"
										tick-count="5"/>
								</chart-axis-x>
								<chart-axis-y axis-id="y"
									axis-position="outer-middle"
									axis-label="% of sample time"
									axis-min="0"
									axis-max="100"
									padding-bottom=0
									padding-top=0>
									<chart-axis-y-tick
										tick-count="5">
								</chart-axis-y>
							</c3chart>
						</div>
					</div>
					<table class="table table-condensed table-info">                                                      
						<tbody>
							<tr>
								<td>Current cycle time:</td>
								<td>{{(execTime[0].Current*sampleTime/100/1000).toFixed(2)}} &mu;s</td>
							</tr>
							<tr>
								<td>Maximum cycle time:</td>
								<td>{{(execTime[0].Maximum*sampleTime/100/1000).toFixed(2)}} &mu;s</td>
						</tbody>
					</table>
					<div class="row">
						<div class="col-sm-12">
								<input class="btn btn-primary btn-xs" type="button" ng-click="resetExecutionTime()" value="Reset Maximum" />
						</div>
					</div>
				</div>
			</div>
         <div class="panel panel-default">
            <div class="panel-heading"><label>Executable</label></div>
            <div class="panel-body">
					<ng-form name="application" novalidate>
					<div class="row">
						<div class="form-group col-sm-8">
							<div class="input-group">
								 <span class="input-group-btn">
									  <span class="btn btn-primary btn-file">
											Browse&hellip; <input type="file" ng-files="appfiles" ng-file="appfile" ng-filename="appfilename" name="filename">
									  </span>
								 </span>
								 <input type="text" class="form-control" ng-model="appfilename" readonly>
							</div>
						</div>
						<div class="form-group col-sm-4">
							<input class="btn btn-primary" type="button" ng-click="loadAndRestart(appfile)" ng-disabled="!appfilename" value="Upload" />
						</div>
					</div>
					<div class="row">
						<div class="form-group col-sm-12">
                     <div class="checkbox-inline">
                        <input type="checkbox" ng-model="meta.startAfterUpload">
                        Start automatically after upload
                     </div>
					   </div>
					</div>
					<div class="row">
						<div class="form-group col-sm-12">
                     <div class="checkbox-inline">
                        <input type="checkbox" ng-model="meta.startOnFirstTrigger">
                        Delay start until first scope trigger
                     </div>
						</div>
					</div>
					<div class="row">
						<div class="form-group btn-toolbar col-sm-12">
							<input class="btn btn-primary btn-space" type="button" ng-click="startExecution()" ng-disabled="startDisabled" value="Start" />
							<input class="btn btn-primary btn-space" type="button" ng-click="stopExecution()" ng-disabled="stopDisabled" value="Stop" />
                                                        <input class="btn btn-primary" type="button" ng-click="rebootSystem()" ng-disabled="rebootDisabled" value="System Reboot" />
						</div>
					</div>
                                        <div class="row">
                                                <div class="form-group col-sm-12">{{rebootAlert}}</div>
                                        </div>
					</ng-form>
           	</div>
         </div>
      </uib-tab>
      <uib-tab index="1" heading="Front panel">
         <div class="panel panel-default">
            <div class="panel-heading"><label>Analog and Digital I/O</label></div>
            <div class="panel-body">
               <div class="d-sub-group">
						<span class="connector-label">Analog In</span>
						<span class="connector-status">{{printVoltageRange(voltageRanges.analogIn)}}</span>
						<ng-include src="'partials/d-sub-37-male.html'" ng-click="openModal('analogIn.html')"></ng-include>
						<span class="connector-label">Analog Out</span>
						<span class="connector-status">{{printVoltageRange(voltageRanges.analogOut)}}</span>
						<ng-include src="'partials/d-sub-37-female.html'" ng-click="openModal('analogOut.html')"></ng-include>
					</div>
					<div class="d-sub-group">
						<span class="connector-label">Digital In</span>
						<span class="connector-status">{{printVoltageRange(voltageRanges.digitalIn)}}</span>
						<ng-include src="'partials/d-sub-37-male.html'" ng-click="openModal('digitalIn.html')"></ng-include>
						<span class="connector-label">Digital Out</span>
						<span class="connector-status">{{printVoltageRange(voltageRanges.digitalOut)}}</span>
						<ng-include src="'partials/d-sub-37-female.html'" ng-click="openModal('digitalOut.html')"></ng-include>
					</div>
					<div class="led-group">
						<div class="led" ng-class="{'led-red': leds.error}">Error</div>
						<div class="led" ng-class="{'led-blue': leds.running}">Running</div>
						<div class="led" ng-class="{'led-green': leds.ready}">Ready</div>
						<div class="led" ng-class="{'led-green': leds.power}">Power</div>
					</div>
				</div>
          </div>
      </uib-tab>
      <uib-tab index="2" heading="Rear panel">
         <div class="panel panel-default">
            <div class="panel-heading"><label>Communication and Mass Storage</label></div>
            <div class="panel-body">
					<div class="sd-card-port connector-group centering">
						<span class="connector-label">SD Card</span>
						<div class="bay"></div>
					</div>
					<div class="usb-port connector-group centering">
						<span class="connector-label">USB</span>
						<div class="bay">
						   <div class="inner">
						      <div class="pin-row"></div>
						   </div>
						</div>
					</div>
					<div class="ethernet-port connector-group centering">
						<span class="connector-label">Ethernet</span>
						<div class="bay" ng-click="openEthernetModal('ethernet.html')">
						   <div class="inner"></div>
						</div>
                                        </div>
					<div class="service-port connector-group centering">
						<span class="connector-label">Service</span>
						<div class="bay">
						   <div class="inner">
						      <div class="pin-row"></div>
						   </div>
						</div>
					</div>
					<div class="interconnect-port connector-group centering">
						<span class="connector-label">Interconnect</span>
						<div class="bay">
						   <div class="module-row">
						      <div class="module"></div>
						      <div class="module"></div>
						   </div>
						   <div class="module-row">
						      <div class="module"></div>
						      <div class="module"></div>
						   </div>
						</div>
					</div>
				</div>
         </div>
      </uib-tab>
      <uib-tab index="3" heading="Diagnostics">
         <div class="panel panel-default">
            <div class="panel-heading"><label>Thermal</label></div>
            <div class="panel-body">
					<div class="row">
						<div class="col-sm-5 col-md-4 col-lg-3">
							<div>FPGA Temperature:</div>
							<c3chart bindto-id="gauge-fpga-temp"
							     padding-bottom="20"
							     chart-data="tempFpga"
							     chart-columns="structTempFpga"
							     transition-duration="0">
							  <chart-size
							     chart-width="200"
							     chart-height="140"/>
							  <chart-gauge min="0"
											max="100"
											units="&deg; C"
											label-format-function="formatTempFpga"
											width="39"/>
							</c3chart>
						</div>
						<div class="col-sm-5 col-md-4 col-lg-3">
							<div>Fan Speed:</div>
							<c3chart bindto-id="gauge-fan-speed"
							     padding-bottom="20"
							     chart-data="fanSpeed"
							     chart-columns="structFanSpeed"
							     transition-duration="0">
							  <chart-size
							     chart-width="200"
							     chart-height="140"/>
							  <chart-gauge min="0"
											max="6000"
											units="rpm"
											label-format-function="formatFanSpeed"
											width="39"/>
							</c3chart>
						</div>
					</div>
				</div>
			</div>
         <div class="panel panel-default">
            <div class="panel-heading"><label>Application Log</label></div>
            <div class="panel-body">
					<div class="row">
						<div class="col-sm-12">
							<pre class="application-log">{{applicationLog}}</pre>
						</div>
					</div>
				</div>
			</div>
      </uib-tab>
      <uib-tab index="4" heading="Info">                                    
         <div class="panel panel-default">
            <div class="panel-heading"><label>IDs and Serial Numbers</label></div>
            <div class="panel-body">
					<table class="table table-condensed table-info">                                                      
						<tbody>
							<tr>
								<td>Host name:</td>
								<td>{{hostname}}</td>
							</tr>
							<tr>
								<td>Ethernet MAC:</td>
								<td>{{ethernetMac}}</td>
							</tr>
							<tr>
								<td>{{ipAddressTitle}}:</td>
								<td>{{ipAddresses}}</td>
							</tr>
								<td>Processor S/N:</td>
								<td>{{serialCpu}}</td>
							</tr>
							<tr>
								<td>Board S/N:</td>
								<td>{{serialBoard}}</td>
							</tr>
							<tr>
								<td>Board revision:</td>
								<td>{{boardRevision}}</td>
							</tr>
							<tr>
								<td>FPGA version:</td>
								<td>{{fpgaVersion}}</td>
							</tr>
							<tr>
								<td>Firmware version:</td>
								<td>{{firmwareVersion}}</td>
							</tr>
							<tr>
								<td>Firmware build:</td>
								<td>{{firmwareBuild}}</td>
                                                        </tr>
							<tr>
								<td>Application library version:</td>
								<td>{{applicationVersion}}</td>
                                                        </tr>
						</tbody>
					</table>
				</div>                                                              
			</div>                                                                 
      </uib-tab>                                                                
   </uib-tabset>
</div>
</ng-form>

</div>
</body>
</html>
